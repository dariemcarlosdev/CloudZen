@using System.ComponentModel.DataAnnotations
@using CloudZen.Services.Abstractions
@inject IEmailProvider _emailService



<section id="contact" class="py-20 bg-gray-50">
    <div class="max-w-3xl mx-auto bg-white p-10 rounded-xl shadow-lg">
        <h2 class="text-4xl font-bold text-center mb-4 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Book a Consultation</h2>
        <p class="text-center text-gray-600 mb-10">
            Fill out the form below and I will contact you within 24 hours.
        </p>

        <EditForm Model="@formModel" OnValidSubmit="HandleValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary class="text-red-600 mb-4" />

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Name</label>
                <InputText @bind-Value="formModel.Name" class="w-full p-3 border rounded-lg" />
                <ValidationMessage For="@(() => formModel.Name)" class="text-red-600 text-sm" />
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Email</label>
                <InputText @bind-Value="formModel.Email" type="email" class="w-full p-3 border rounded-lg" />
                <ValidationMessage For="@(() => formModel.Email)" class="text-red-600 text-sm" />
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Subject</label>
                <InputText @bind-Value="formModel.Subject" class="w-full p-3 border rounded-lg" />
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Message</label>
                <InputTextArea @bind-Value="formModel.Message" class="w-full p-3 border rounded-lg h-32" />
                <ValidationMessage For="@(() => formModel.Message)" class="text-red-600 text-sm" />
            </div>

            <button type="submit" class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700">
                Submit Request
            </button>
        </EditForm>

        @if (submitted)
        {
            <div class="mt-6 p-4 bg-green-100 text-green-700 rounded-lg">
                !Thank you! We’ve received your request and will contact you shortly.
            </div>
        }
    </div>
</section>

@code {
    private ContactFormModel formModel = new();
    private bool submitted = false;

    private async Task HandleValidSubmit()
    {
        // TODO: Send email / call API
        await _emailService.SendEmailAsync(            
            formModel.Subject,
            formModel.Message!,
            formModel.Name!,
            formModel.Email!
        );        
        
        submitted = true;
    }

    public class ContactFormModel
    {
        [Required(ErrorMessage = "Name is required")]
        public string? Name { get; set; }

        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string? Email { get; set; }

        [Required(ErrorMessage = "Subject is required")]
        public string? Subject { get; set; }

        [Required(ErrorMessage = "Message is required")]
        [StringLength(500, ErrorMessage = "Message too long (max 500 chars)")]
        public string? Message { get; set; }
    }
}
